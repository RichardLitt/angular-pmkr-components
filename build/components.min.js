/*
pmkr.components v0.0.0
https://github.com/m59peacemaker/angular-pmkr-components
License: MIT
Author: Johnny Hauser
File created: 9.7.2014
*/

angular.module("pmkr.components",["pmkr.components.filters","pmkr.components.services","pmkr.components.directives"]),angular.module("pmkr.components.directives",["pmkr.pristineOriginal","pmkr.validateCustom"]),angular.module("pmkr.components.filters",["pmkr.offset","pmkr.partition","pmkr.shuffle","pmkr.slugify","pmkr.stripTags","pmkr.spaceSentences","pmkr.limitEllipsis"]),angular.module("pmkr.components.services",["pmkr.debounce","pmkr.memoize","pmkr.filterStabilize","pmkr.rethrowException"]),angular.module("pmkr.pristineOriginal",[]).directive("pmkrPristineOriginal",[function(){var e={restrict:"A",require:"ngModel",link:function(e,t,n,r){var o=null;e.$watch(function(){return r.$viewValue},function(e){null===o&&(o=r.$isEmpty(e)?"":e.toString()),o===e&&r.$setPristine()})}};return e}]),angular.module("pmkr.validateCustom",["pmkr.debounce"]).directive("pmkrValidateCustom",["$q","pmkr.debounce",function(e,t){var n={restrict:"A",require:"ngModel",priority:1,link:function(e,n,r,o){function i(e){o.$setValidity(l.name,e),p.valid=s?p.invalid=null:!(p.invalid=!e)}function a(e){return s?void 0:(p.validating=!0,l.fn(e))}function u(e){return l.gate&&(s=l.gate(e,o))?(p.pending=p.validating=!1,void i(!0)):(p.pending=!0,p.valid=p.invalid=null,void f(e).then(function(t){s||(p.checkedValue=e,i(t),p.pending=p.validating=!1)}))}var l=e.$eval(r.pmkrValidateCustom),p={pending:!1,validating:!1,checkedValue:null,valid:null,invalid:null};l.props&&(e[l.props]=p),i(!0);var s=!1,c=t(a,l.wait),f=t.latest(c);e.$watch(function(){return o.$viewValue},u)}};return n}]),angular.module("pmkr.limitEllipsis",["pmkr.stripTags","pmkr.spaceSentences"]).filter("pmkr.limitEllipsis",["$filter",function(e){function t(e,t,i){if(!e||!e.length)return e;i=i||"...";var a=r(n(e)),u=o(a,t);return u===a?u:u+i}var n=e("pmkr.stripTags"),r=e("pmkr.spaceSentences"),o=e("limitTo");return t}]),angular.module("pmkr.offset",[]).filter("pmkr.offset",[function(){function e(e,t){return e&&e.length?(t=parseInt(t,10),e.slice(t)):e}return e}]),angular.module("pmkr.partition",["pmkr.filterStabilize"]).filter("pmkr.partition",["pmkr.filterStabilize",function(e){var t=e(function(e,t){if(!e||!t)return e;for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n});return t}]),angular.module("pmkr.shuffle",["pmkr.filterStabilize"]).filter("pmkr.shuffle",["pmkr.filterStabilize",function(e){function t(e){for(var t=e.length;0!==t;){var n=Math.floor(Math.random()*t);t-=1;var r=e[t];e[t]=e[n],e[n]=r}return e}var n=e(function(e){return e?"string"==typeof e?(e=e.split(""),t(e),e.join("")):void t(e):e});return n}]),angular.module("pmkr.slugify",[]).filter("pmkr.slugify",[function(){function e(e){if(!e)return e;var t=e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");return t}return e}]),angular.module("pmkr.spaceSentences",[]).filter("pmkr.spaceSentences",[function(){function e(e){if(!e)return e;var t=e.replace(/(\w)([.!?]+)(\w)/gi,"$1$2 $3");return t}return e}]),angular.module("pmkr.stripTags",[]).filter("pmkr.stripTags",function(){function e(e,t,n){if(!e)return e;t=t?t.split(","):"";var r=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,o=e.replace(r,function(e,r){var o=~t.indexOf(r.toLowerCase()),i=n?o:!o,a=i?"":e;return a});return o}return e}),angular.module("pmkr.debounce",[]).factory("pmkr.debounce",["$timeout","$q",function(e,t){function n(n,r){function o(){var o=t.defer(),a=this,u=arguments;return e.cancel(i),i=e(function(){o.resolve(n.apply(a,u))},r),o.promise}var i;return o}function r(n,r){function o(){var o=t.defer(),a=this,u=arguments;return i||o.resolve(n.apply(a,u)),e.cancel(i),i=e(function(){i=null},r),o.promise}var i;return o}function o(e){function n(){var n=r=JSON.stringify(arguments),o=t.defer();return e.apply(this,arguments).then(function(e){r===n&&o.resolve(e)},function(e){r===n&&o.reject(e)}),o.promise}var r;return n}var i=function(){return n.apply(this,arguments)};return i.immediate=function(){return r.apply(this,arguments)},i.latest=function(){return o.apply(this,arguments)},i}]),angular.module("pmkr.memoize",[]).factory("pmkr.memoize",[function(){function e(){return t.apply(this,arguments)}function t(e){function t(){var t=[].slice.call(arguments),r=JSON.stringify(t),o=n[r];return o?o:(n[r]=e.apply(this,arguments),n[r])}var n={};return t}return e}]),angular.module("pmkr.filterStabilize",["pmkr.memoize"]).factory("pmkr.filterStabilize",["pmkr.memoize",function(e){function t(t){function n(){var e=[].slice.call(arguments);e=angular.copy(e);var n=t.apply(this,e)||e[0];return n}var r=e(n);return r}return t}]),angular.module("pmkr.rethrowException",[]).provider("pmkr.rethrowException",["$provide",function(e){function t(e){function t(t,n){throw e(t,n),t}return t}this.init=function(){e.decorator("$exceptionHandler",["$delegate",t])},this.$get=function(){}}]),describe("pristineOriginal",function(){var e,t,n,r;beforeEach(module("pmkr.pristineOriginal")),beforeEach(inject(function(o,i){e=o,t=i,n=angular.element('<form name="form"></form>'),r=angular.element('<input name="foo" ng-model="foo" pmkr-pristine-original="">'),n.append(r)})),it("should return ngModel to pristine when original value is empty and value becomes empty again",function(){e(n)(t),t.$digest(),t.form.foo.$setViewValue("abc"),t.$digest(),expect(t.form.foo.$dirty).toBe(!0),t.form.foo.$setViewValue(""),t.$digest(),expect(t.form.foo.$pristine).toBe(!0)}),it('should return ngModel to pristine when original value is "abc" and value becomes "abc" again',function(){t.foo="abc",e(n)(t),t.$digest(),t.form.foo.$setViewValue("123"),t.$digest(),expect(t.form.foo.$dirty).toBe(!0),t.form.foo.$setViewValue("abc"),t.$digest(),expect(t.form.foo.$pristine).toBe(!0)})}),angular.module("pmkr.debounce",[]).factory("pmkr.debounce",function(e){function t(t){return function(){return e.when(t())}}var n=t;return n.latest=t,n}),describe("validateCustom",function(){var e,t,n,r,o;beforeEach(module("pmkr.validateCustom")),beforeEach(module(["$provide",function(e){n=e}])),beforeEach(inject(function(n,i){e=n,t=i,r=angular.element('<form name="form"></form>'),o=angular.element('<input name="foo" ng-model="foo">'),r.append(o),t.opts={name:"unique"}})),it("should accept argument object as view string",function(){t.fooValid=function(){},spyOn(t,"fooValid"),o.attr("pmkr-validate-custom","{name:'unique', fn:fooValid}"),e(r)(t),t.$digest(),expect(t.fooValid).toHaveBeenCalled()}),it("should accept argument object from controller",function(){t.opts.fn=function(){},spyOn(t.opts,"fn"),o.attr("pmkr-validate-custom","opts"),e(r)(t),t.$digest(),expect(t.opts.fn).toHaveBeenCalled()}),it("should initially be valid",function(){o.attr("pmkr-validate-custom","opts"),e(r)(t),expect(t.form.foo.$error.unique).toBe(!1)}),it("should not call opts.fn when gated",function(){t.opts.fn=function(){},t.opts.gate=function(){return!0},spyOn(t.opts,"fn"),o.attr("pmkr-validate-custom","opts"),e(r)(t),t.$digest(),expect(t.opts.fn).not.toHaveBeenCalled()}),it("should be valid when gated",function(){t.opts.gate=function(){return!0},o.attr("pmkr-validate-custom","opts"),e(r)(t),t.form.foo.$setValidity("unique",!1),t.$digest(),expect(t.form.foo.$error.unique).toBe(!1)}),it("should wrap opts.fn in debounce and debounce.latest",function(){var i=!1,a=!1;n.decorator("pmkr.debounce",function(){var e=function(){i=!0};return e.latest=function(){a=!0},e}),o.attr("pmkr-validate-custom","opts"),e(r)(t),expect(i).toBe(!0),expect(a).toBe(!0)}),it("should be valid when opts.fn returns true",function(){t.opts.fn=function(){return!0},o.attr("pmkr-validate-custom","opts"),e(r)(t),t.form.foo.$setValidity("unique",!1),t.$digest(),expect(t.form.foo.$error.unique).toBe(!1)}),it("should be invalid when opts.fn returns false",function(){t.opts.fn=function(){return!1},o.attr("pmkr-validate-custom","opts"),e(r)(t),t.form.foo.$setValidity("unique",!1),t.$digest(),expect(t.form.foo.$error.unique).toBe(!0)}),it("should set props.pending = true while debouncing/validating",function(){n.decorator("pmkr.debounce",function(e){function n(n){return function(){return expect(t.fooProps.pending).toBe(!0),e.when(n())}}var r=n;return r.latest=n,r}),t.opts.props="fooProps",t.opts.fn=function(){expect(t.fooProps.pending).toBe(!0)},o.attr("pmkr-validate-custom","opts"),e(r)(t),expect(t.fooProps.pending).toBe(!1),t.$digest(),expect(t.fooProps.pending).toBe(!1)}),it("should set props.validating = true while validating",function(){n.decorator("pmkr.debounce",function(e){function n(n){return function(){return expect(t.fooProps.validating).toBe(!1),e.when(n())}}var r=n;return r.latest=n,r}),t.opts.props="fooProps",t.opts.fn=function(){expect(t.fooProps.validating).toBe(!0)},o.attr("pmkr-validate-custom","opts"),e(r)(t),expect(t.fooProps.validating).toBe(!1),t.$digest(),expect(t.fooProps.validating).toBe(!1)}),it("should set props.checkedValue to the most recent checked value",function(){t.opts.fn=function(){return!0},t.opts.props="fooProps",o.attr("pmkr-validate-custom","opts"),e(r)(t),expect(t.fooProps.checkedValue).toBe(null),t.form.foo.$setViewValue("abc"),t.$digest(),expect(t.fooProps.checkedValue).toBe("abc")})});
//# sourceMappingURL=components.min.js.map