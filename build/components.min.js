/*
pmkr.components v0.0.0
https://github.com/m59peacemaker/angular-pmkr-components
License: MIT
Author: Johnny Hauser
File created: 9.10.2014
*/

angular.module("pmkr.components",["pmkr.components.filters","pmkr.components.services","pmkr.components.directives"]),angular.module("pmkr.components.directives",["pmkr.pristineOriginal","pmkr.validateCustom"]),angular.module("pmkr.components.filters",["pmkr.offset","pmkr.partition","pmkr.shuffle","pmkr.slugify","pmkr.stripTags","pmkr.spaceSentences","pmkr.limitEllipsis"]),angular.module("pmkr.components.services",["pmkr.debounce","pmkr.memoize","pmkr.filterStabilize","pmkr.rethrowException"]),angular.module("pmkr.pristineOriginal",[]).directive("pmkrPristineOriginal",[function(){var t={restrict:"A",require:"ngModel",link:function(t,e,n,o){var r=null;t.$watch(function(){return o.$viewValue},function(t){null===r&&(r=o.$isEmpty(t)?"":t.toString()),r===t&&o.$setPristine()})}};return t}]),angular.module("pmkr.validateCustom",["pmkr.debounce"]).directive("pmkrValidateCustom",["$q","pmkr.debounce",function(t,e){var n={restrict:"A",require:"ngModel",priority:1,link:function(t,n,o,r){function i(t){r.$setValidity(p.name,t),l.valid=f?l.invalid=null:!(l.invalid=!t)}function a(t){return f?void 0:(l.validating=!0,p.fn(t))}function u(t){return p.gate&&(f=p.gate(t,r))?(l.pending=l.validating=!1,void i(!0)):(l.pending=!0,l.valid=l.invalid=null,void c(t).then(function(e){f||(l.checkedValue=t,i(e),l.pending=l.validating=!1)}))}var p=t.$eval(o.pmkrValidateCustom),l={pending:!1,validating:!1,checkedValue:null,valid:null,invalid:null};p.props&&(t[p.props]=l);var s=e(a,p.wait),c=e.latest(s);r.$setValidity(p.name,!0);var f;t.$watch(function(){return r.$viewValue},u)}};return n}]),angular.module("pmkr.offset",[]).filter("pmkr.offset",[function(){function t(t,e){return t&&t.length?(e=parseInt(e,10),t.slice(e)):t}return t}]),angular.module("pmkr.limitEllipsis",["pmkr.stripTags","pmkr.spaceSentences"]).filter("pmkr.limitEllipsis",["$filter",function(t){function e(t,e,i){if(!t||!t.length)return t;i=i||"...";var a=o(n(t)),u=r(a,e);return u===a?u:u+i}var n=t("pmkr.stripTags"),o=t("pmkr.spaceSentences"),r=t("limitTo");return e}]),angular.module("pmkr.partition",["pmkr.filterStabilize"]).filter("pmkr.partition",["pmkr.filterStabilize",function(t){var e=t(function(t,e){if(!t||!e)return t;for(var n=[],o=0;o<t.length;o+=e)n.push(t.slice(o,o+e));return n});return e}]),angular.module("pmkr.shuffle",["pmkr.filterStabilize"]).filter("pmkr.shuffle",["pmkr.filterStabilize",function(t){function e(t){for(var e=t.length;0!==e;){var n=Math.floor(Math.random()*e);e-=1;var o=t[e];t[e]=t[n],t[n]=o}return t}var n=t(function(t){return t?"string"==typeof t?(t=t.split(""),e(t),t.join("")):void e(t):t});return n}]),angular.module("pmkr.slugify",[]).filter("pmkr.slugify",[function(){function t(t){if(!t)return t;var e=t.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");return e}return t}]),angular.module("pmkr.spaceSentences",[]).filter("pmkr.spaceSentences",[function(){function t(t){if(!t)return t;var e=t.replace(/(\w)([.!?]+)(\w)/gi,"$1$2 $3");return e}return t}]),angular.module("pmkr.stripTags",[]).filter("pmkr.stripTags",function(){function t(t,e,n){if(!t)return t;e=e?e.split(","):"";var o=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,r=t.replace(o,function(t,o){var r=~e.indexOf(o.toLowerCase()),i=n?r:!r,a=i?"":t;return a});return r}return t}),angular.module("pmkr.debounce",[]).factory("pmkr.debounce",["$timeout","$q",function(t,e){function n(n,o){function r(){var r=e.defer(),a=this,u=arguments;return t.cancel(i),i=t(function(){r.resolve(n.apply(a,u))},o),r.promise}var i;return r}function o(n,o){function r(){var r=e.defer(),a=this,u=arguments;return i||r.resolve(n.apply(a,u)),t.cancel(i),i=t(function(){i=null},o),r.promise}var i;return r}function r(t){function n(){var n=o=JSON.stringify(arguments),r=e.defer();return t.apply(this,arguments).then(function(t){o===n&&r.resolve(t)},function(t){o===n&&r.reject(t)}),r.promise}var o;return n}var i=function(){return n.apply(this,arguments)};return i.immediate=function(){return o.apply(this,arguments)},i.latest=function(){return r.apply(this,arguments)},i}]),angular.module("pmkr.memoize",[]).factory("pmkr.memoize",[function(){function t(){return e.apply(this,arguments)}function e(t){function e(){var e=[].slice.call(arguments),o=JSON.stringify(e),r=n[o];return r?r:(n[o]=t.apply(this,arguments),n[o])}var n={};return e}return t}]),angular.module("pmkr.filterStabilize",["pmkr.memoize"]).factory("pmkr.filterStabilize",["pmkr.memoize",function(t){function e(e){function n(){var t=[].slice.call(arguments);t=angular.copy(t);var n=e.apply(this,t)||t[0];return n}var o=t(n);return o}return e}]),angular.module("pmkr.rethrowException",[]).provider("pmkr.rethrowException",["$provide",function(t){function e(t){function e(e,n){throw t(e,n),e}return e}this.init=function(){t.decorator("$exceptionHandler",["$delegate",e])},this.$get=function(){}}]),describe("pristineOriginal",function(){var t,e,n,o;beforeEach(module("pmkr.pristineOriginal")),beforeEach(inject(function(r,i){t=r,e=i,n=angular.element('<form name="form"></form>'),o=angular.element('<input name="foo" ng-model="foo" pmkr-pristine-original="">'),n.append(o)})),it("should return ngModel to pristine when original value is empty and value becomes empty again",function(){t(n)(e),e.$digest(),e.form.foo.$setViewValue("abc"),e.$digest(),expect(e.form.foo.$dirty).toBe(!0),e.form.foo.$setViewValue(""),e.$digest(),expect(e.form.foo.$pristine).toBe(!0)}),it('should return ngModel to pristine when original value is "abc" and value becomes "abc" again',function(){e.foo="abc",t(n)(e),e.$digest(),e.form.foo.$setViewValue("123"),e.$digest(),expect(e.form.foo.$dirty).toBe(!0),e.form.foo.$setViewValue("abc"),e.$digest(),expect(e.form.foo.$pristine).toBe(!0)})}),angular.module("pmkr.debounce",[]).factory("pmkr.debounce",function(t){function e(e){return function(){return t.when(e())}}var n=e;return n.latest=e,n}),describe("validateCustom",function(){var t,e,n,o,r;beforeEach(module("pmkr.validateCustom")),beforeEach(module(["$provide",function(t){n=t}])),beforeEach(inject(function(n,i){t=n,e=i,o=angular.element('<form name="form"></form>'),r=angular.element('<input name="foo" ng-model="foo">'),o.append(r),e.opts={name:"unique"}})),it("should accept argument object as view string",function(){e.fooValid=function(){},spyOn(e,"fooValid"),r.attr("pmkr-validate-custom","{name:'unique', fn:fooValid}"),t(o)(e),e.$digest(),expect(e.fooValid).toHaveBeenCalled()}),it("should accept argument object from controller",function(){e.opts.fn=function(){},spyOn(e.opts,"fn"),r.attr("pmkr-validate-custom","opts"),t(o)(e),e.$digest(),expect(e.opts.fn).toHaveBeenCalled()}),it("should initially be valid",function(){r.attr("pmkr-validate-custom","opts"),t(o)(e),expect(e.form.foo.$error.unique).toBe(!1)}),it("should not call `opts.fn` when gated",function(){e.opts.fn=function(){},e.opts.gate=function(){return!0},spyOn(e.opts,"fn"),r.attr("pmkr-validate-custom","opts"),t(o)(e),e.$digest(),expect(e.opts.fn).not.toHaveBeenCalled()}),it("should be valid when gated",function(){e.opts.gate=function(){return!0},r.attr("pmkr-validate-custom","opts"),t(o)(e),e.form.foo.$setValidity("unique",!1),e.$digest(),expect(e.form.foo.$error.unique).toBe(!1)}),it("should wrap `opts.fn` in `debounce` and `debounce.latest`",function(){var i=!1,a=!1;n.decorator("pmkr.debounce",function(){var t=function(){i=!0};return t.latest=function(){a=!0},t}),r.attr("pmkr-validate-custom","opts"),t(o)(e),expect(i).toBe(!0),expect(a).toBe(!0)}),it("should be valid when `opts.fn` returns `true`",function(){e.opts.fn=function(){return!0},r.attr("pmkr-validate-custom","opts"),t(o)(e),e.form.foo.$setValidity("unique",!1),e.$digest(),expect(e.form.foo.$error.unique).toBe(!1)}),it("should set $error[opts.name] `true` when `opts.fn` returns `false`",function(){e.opts.fn=function(){return!1},r.attr("pmkr-validate-custom","opts"),t(o)(e),e.form.foo.$setValidity("unique",!1),e.$digest(),expect(e.form.foo.$error.unique).toBe(!0)}),it("should set `props.pending` `true` while debouncing/validating",function(){n.decorator("pmkr.debounce",function(t){function n(n){return function(){return expect(e.fooProps.pending).toBe(!0),t.when(n())}}var o=n;return o.latest=n,o}),e.opts.props="fooProps",e.opts.fn=function(){expect(e.fooProps.pending).toBe(!0)},r.attr("pmkr-validate-custom","opts"),t(o)(e),expect(e.fooProps.pending).toBe(!1),e.$digest(),expect(e.fooProps.pending).toBe(!1)}),it("should set `props.validating` `true` while validating",function(){n.decorator("pmkr.debounce",function(t){function n(n){return function(){return expect(e.fooProps.validating).toBe(!1),t.when(n())}}var o=n;return o.latest=n,o}),e.opts.props="fooProps",e.opts.fn=function(){expect(e.fooProps.validating).toBe(!0)},r.attr("pmkr-validate-custom","opts"),t(o)(e),expect(e.fooProps.validating).toBe(!1),e.$digest(),expect(e.fooProps.validating).toBe(!1)}),it("should set `props.pending`,`props.validating` to `false` when gated",function(){e.opts.gate=function(){return!0},e.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),t(o)(e),expect(e.fooProps.pending).toBe(!1),expect(e.fooProps.validating).toBe(!1),e.fooProps.pending=!0,e.fooProps.validating=!0,e.$digest(),expect(e.fooProps.pending).toBe(!1),expect(e.fooProps.validating).toBe(!1)}),it("should set `props.checkedValue` to the most recent checked value",function(){e.opts.fn=function(){return!0},e.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),t(o)(e),expect(e.fooProps.checkedValue).toBe(null),e.form.foo.$setViewValue("abc"),e.$digest(),expect(e.fooProps.checkedValue).toBe("abc")}),it("should initially set `props.valid` and `props.invalid` to `null`",function(){e.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),t(o)(e),expect(e.fooProps.valid).toBe(null),expect(e.fooProps.invalid).toBe(null)}),it("should set `props.valid` and `props.invalid` to `null` when gated",function(){e.opts.props="fooProps",e.opts.gate=function(){return!0},r.attr("pmkr-validate-custom","opts"),t(o)(e),e.$digest(),expect(e.fooProps.valid).toBe(null),expect(e.fooProps.invalid).toBe(null)}),it("should set `props.valid` and `props.invalid` to result after validating",function(){e.opts.fn=function(){return!0},e.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),t(o)(e),e.$digest(),expect(e.fooProps.valid).toBe(!0),expect(e.fooProps.invalid).toBe(!1)})});
//# sourceMappingURL=components.min.js.map