/*
pmkr.components v0.0.0
https://github.com/m59peacemaker/angular-pmkr-components
License: MIT
Author: Johnny Hauser
File created: 9.10.2014
*/

angular.module("pmkr.components",["pmkr.components.filters","pmkr.components.services","pmkr.components.directives"]),angular.module("pmkr.components.directives",["pmkr.pristineOriginal","pmkr.validateCustom"]),angular.module("pmkr.components.filters",["pmkr.offset","pmkr.partition","pmkr.shuffle","pmkr.slugify","pmkr.stripTags","pmkr.spaceSentences","pmkr.limitEllipsis"]),angular.module("pmkr.components.services",["pmkr.debounce","pmkr.memoize","pmkr.filterStabilize","pmkr.rethrowException"]),angular.module("pmkr.pristineOriginal",[]).directive("pmkrPristineOriginal",[function(){var e={restrict:"A",require:"ngModel",link:function(e,t,o,n){var r={caseSensitive:!0},i=e.$eval(o.pmkrPristineOriginal);i=angular.extend(r,i);var a=null;e.$watch(function(){return n.$viewValue},function(e){null===a&&(a=n.$isEmpty(e)?"":e.toString());var t;a===e?t=!0:i.caseSensitive||a.toLowerCase()!==e.toLowerCase()||(t=!0),t&&n.$setPristine()})}};return e}]),angular.module("pmkr.validateCustom",["pmkr.debounce"]).directive("pmkrValidateCustom",["$q","pmkr.debounce",function(e,t){var o={restrict:"A",require:"ngModel",priority:1,link:function(e,o,n,r){function i(e){r.$setValidity(p.name,e),s.valid=f?s.invalid=null:!(s.invalid=!e)}function a(e){return f?void 0:(s.validating=!0,p.fn(e))}function u(e){return p.gate&&(f=p.gate(e,r))?(s.pending=s.validating=!1,void i(!0)):(s.pending=!0,s.valid=s.invalid=null,void c(e).then(function(t){f||(s.checkedValue=e,i(t),s.pending=s.validating=!1)}))}var p=e.$eval(n.pmkrValidateCustom),s={pending:!1,validating:!1,checkedValue:null,valid:null,invalid:null};p.props&&(e[p.props]=s);var l=t(a,p.wait),c=t.latest(l);r.$setValidity(p.name,!0);var f;e.$watch(function(){return r.$viewValue},u)}};return o}]),angular.module("pmkr.limitEllipsis",["pmkr.stripTags","pmkr.spaceSentences"]).filter("pmkr.limitEllipsis",["$filter",function(e){function t(e,t,i){if(!e||!e.length)return e;i=i||"...";var a=n(o(e)),u=r(a,t);return u===a?u:u+i}var o=e("pmkr.stripTags"),n=e("pmkr.spaceSentences"),r=e("limitTo");return t}]),angular.module("pmkr.offset",[]).filter("pmkr.offset",[function(){function e(e,t){return e&&e.length?(t=parseInt(t,10),e.slice(t)):e}return e}]),angular.module("pmkr.partition",["pmkr.filterStabilize"]).filter("pmkr.partition",["pmkr.filterStabilize",function(e){var t=e(function(e,t){if(!e||!t)return e;for(var o=[],n=0;n<e.length;n+=t)o.push(e.slice(n,n+t));return o});return t}]),angular.module("pmkr.shuffle",["pmkr.filterStabilize"]).filter("pmkr.shuffle",["pmkr.filterStabilize",function(e){function t(e){for(var t=e.length;0!==t;){var o=Math.floor(Math.random()*t);t-=1;var n=e[t];e[t]=e[o],e[o]=n}return e}var o=e(function(e){return e?"string"==typeof e?(e=e.split(""),t(e),e.join("")):void t(e):e});return o}]),angular.module("pmkr.slugify",[]).filter("pmkr.slugify",[function(){function e(e){if(!e)return e;var t=e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");return t}return e}]),angular.module("pmkr.spaceSentences",[]).filter("pmkr.spaceSentences",[function(){function e(e){if(!e)return e;var t=e.replace(/(\w)([.!?]+)(\w)/gi,"$1$2 $3");return t}return e}]),angular.module("pmkr.stripTags",[]).filter("pmkr.stripTags",function(){function e(e,t,o){if(!e)return e;t=t?t.split(","):"";var n=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,r=e.replace(n,function(e,n){var r=~t.indexOf(n.toLowerCase()),i=o?r:!r,a=i?"":e;return a});return r}return e}),angular.module("pmkr.debounce",[]).factory("pmkr.debounce",["$timeout","$q",function(e,t){function o(o,n){function r(){var r=t.defer(),a=this,u=arguments;return e.cancel(i),i=e(function(){r.resolve(o.apply(a,u))},n),r.promise}var i;return r}function n(o,n){function r(){var r=t.defer(),a=this,u=arguments;return i||r.resolve(o.apply(a,u)),e.cancel(i),i=e(function(){i=null},n),r.promise}var i;return r}function r(e){function o(){var o=n=JSON.stringify(arguments),r=t.defer();return e.apply(this,arguments).then(function(e){n===o&&r.resolve(e)},function(e){n===o&&r.reject(e)}),r.promise}var n;return o}var i=function(){return o.apply(this,arguments)};return i.immediate=function(){return n.apply(this,arguments)},i.latest=function(){return r.apply(this,arguments)},i}]),angular.module("pmkr.filterStabilize",["pmkr.memoize"]).factory("pmkr.filterStabilize",["pmkr.memoize",function(e){function t(t){function o(){var e=[].slice.call(arguments);e=angular.copy(e);var o=t.apply(this,e)||e[0];return o}var n=e(o);return n}return t}]),angular.module("pmkr.rethrowException",[]).provider("pmkr.rethrowException",["$provide",function(e){function t(e){function t(t,o){throw e(t,o),t}return t}this.init=function(){e.decorator("$exceptionHandler",["$delegate",t])},this.$get=function(){}}]),angular.module("pmkr.memoize",[]).factory("pmkr.memoize",[function(){function e(){return t.apply(this,arguments)}function t(e){function t(){var t=[].slice.call(arguments),n=JSON.stringify(t),r=o[n];return r?r:(o[n]=e.apply(this,arguments),o[n])}var o={};return t}return e}]),describe("pristineOriginal",function(){var e,t,o,n;beforeEach(module("pmkr.pristineOriginal")),beforeEach(inject(function(r,i){e=r,t=i,t.opts={},o=angular.element('<form name="form"></form>'),n=angular.element('<input name="foo" ng-model="foo" pmkr-pristine-original="opts">'),o.append(n)})),it("should return ngModel to pristine when original value is empty and value becomes empty again",function(){e(o)(t),t.$digest(),t.form.foo.$setViewValue("abc"),t.$digest(),expect(t.form.foo.$dirty).toBe(!0),t.form.foo.$setViewValue(""),t.$digest(),expect(t.form.foo.$pristine).toBe(!0)}),it('should return ngModel to pristine when original value is "abc" and value becomes "abc" again',function(){t.foo="abc",e(o)(t),t.$digest(),t.form.foo.$setViewValue("123"),t.$digest(),expect(t.form.foo.$dirty).toBe(!0),t.form.foo.$setViewValue("abc"),t.$digest(),expect(t.form.foo.$pristine).toBe(!0)}),it('should return ngModel to pristine when original value is "abc" and value becomes "Abc" if `opts.caseSensitive:false`',function(){t.foo="abc",t.opts.caseSensitive=!1,e(o)(t),t.$digest(),t.form.foo.$setViewValue("Abc"),t.$digest(),expect(t.form.foo.$pristine).toBe(!0)})}),angular.module("pmkr.debounce",[]).factory("pmkr.debounce",function(e){function t(t){return function(){return e.when(t())}}var o=t;return o.latest=t,o}),describe("validateCustom",function(){var e,t,o,n,r;beforeEach(module("pmkr.validateCustom")),beforeEach(module(["$provide",function(e){o=e}])),beforeEach(inject(function(o,i){e=o,t=i,n=angular.element('<form name="form"></form>'),r=angular.element('<input name="foo" ng-model="foo">'),n.append(r),t.opts={name:"unique"}})),it("should accept argument object as view string",function(){t.fooValid=function(){},spyOn(t,"fooValid"),r.attr("pmkr-validate-custom","{name:'unique', fn:fooValid}"),e(n)(t),t.$digest(),expect(t.fooValid).toHaveBeenCalled()}),it("should accept argument object from controller",function(){t.opts.fn=function(){},spyOn(t.opts,"fn"),r.attr("pmkr-validate-custom","opts"),e(n)(t),t.$digest(),expect(t.opts.fn).toHaveBeenCalled()}),it("should initially be valid",function(){r.attr("pmkr-validate-custom","opts"),e(n)(t),expect(t.form.foo.$error.unique).toBe(!1)}),it("should not call `opts.fn` when gated",function(){t.opts.fn=function(){},t.opts.gate=function(){return!0},spyOn(t.opts,"fn"),r.attr("pmkr-validate-custom","opts"),e(n)(t),t.$digest(),expect(t.opts.fn).not.toHaveBeenCalled()}),it("should be valid when gated",function(){t.opts.gate=function(){return!0},r.attr("pmkr-validate-custom","opts"),e(n)(t),t.form.foo.$setValidity("unique",!1),t.$digest(),expect(t.form.foo.$error.unique).toBe(!1)}),it("should wrap `opts.fn` in `debounce` and `debounce.latest`",function(){var i=!1,a=!1;o.decorator("pmkr.debounce",function(){var e=function(){i=!0};return e.latest=function(){a=!0},e}),r.attr("pmkr-validate-custom","opts"),e(n)(t),expect(i).toBe(!0),expect(a).toBe(!0)}),it("should be valid when `opts.fn` returns `true`",function(){t.opts.fn=function(){return!0},r.attr("pmkr-validate-custom","opts"),e(n)(t),t.form.foo.$setValidity("unique",!1),t.$digest(),expect(t.form.foo.$error.unique).toBe(!1)}),it("should set $error[opts.name] `true` when `opts.fn` returns `false`",function(){t.opts.fn=function(){return!1},r.attr("pmkr-validate-custom","opts"),e(n)(t),t.form.foo.$setValidity("unique",!1),t.$digest(),expect(t.form.foo.$error.unique).toBe(!0)}),it("should set `props.pending` `true` while debouncing/validating",function(){o.decorator("pmkr.debounce",function(e){function o(o){return function(){return expect(t.fooProps.pending).toBe(!0),e.when(o())}}var n=o;return n.latest=o,n}),t.opts.props="fooProps",t.opts.fn=function(){expect(t.fooProps.pending).toBe(!0)},r.attr("pmkr-validate-custom","opts"),e(n)(t),expect(t.fooProps.pending).toBe(!1),t.$digest(),expect(t.fooProps.pending).toBe(!1)}),it("should set `props.validating` `true` while validating",function(){o.decorator("pmkr.debounce",function(e){function o(o){return function(){return expect(t.fooProps.validating).toBe(!1),e.when(o())}}var n=o;return n.latest=o,n}),t.opts.props="fooProps",t.opts.fn=function(){expect(t.fooProps.validating).toBe(!0)},r.attr("pmkr-validate-custom","opts"),e(n)(t),expect(t.fooProps.validating).toBe(!1),t.$digest(),expect(t.fooProps.validating).toBe(!1)}),it("should set `props.pending`,`props.validating` to `false` when gated",function(){t.opts.gate=function(){return!0},t.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),e(n)(t),expect(t.fooProps.pending).toBe(!1),expect(t.fooProps.validating).toBe(!1),t.fooProps.pending=!0,t.fooProps.validating=!0,t.$digest(),expect(t.fooProps.pending).toBe(!1),expect(t.fooProps.validating).toBe(!1)}),it("should set `props.checkedValue` to the most recent checked value",function(){t.opts.fn=function(){return!0},t.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),e(n)(t),expect(t.fooProps.checkedValue).toBe(null),t.form.foo.$setViewValue("abc"),t.$digest(),expect(t.fooProps.checkedValue).toBe("abc")}),it("should initially set `props.valid` and `props.invalid` to `null`",function(){t.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),e(n)(t),expect(t.fooProps.valid).toBe(null),expect(t.fooProps.invalid).toBe(null)}),it("should set `props.valid` and `props.invalid` to `null` when gated",function(){t.opts.props="fooProps",t.opts.gate=function(){return!0},r.attr("pmkr-validate-custom","opts"),e(n)(t),t.$digest(),expect(t.fooProps.valid).toBe(null),expect(t.fooProps.invalid).toBe(null)}),it("should set `props.valid` and `props.invalid` to result after validating",function(){t.opts.fn=function(){return!0},t.opts.props="fooProps",r.attr("pmkr-validate-custom","opts"),e(n)(t),t.$digest(),expect(t.fooProps.valid).toBe(!0),expect(t.fooProps.invalid).toBe(!1)})});
//# sourceMappingURL=components.min.js.map