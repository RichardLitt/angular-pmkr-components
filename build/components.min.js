/*
pmkr.components v0.0.0
https://github.com/m59peacemaker/angular-pmkr-components
License: MIT
Author: Johnny Hauser
File created: 9.6.2014
*/

angular.module("pmkr.components",["pmkr.components.filters","pmkr.components.services","pmkr.components.directives"]),angular.module("pmkr.components.directives",["pmkr.pristineOriginal","pmkr.validateCustom"]),angular.module("pmkr.components.filters",["pmkr.offset","pmkr.partition","pmkr.shuffle","pmkr.slugify","pmkr.stripTags","pmkr.spaceSentences","pmkr.limitEllipsis"]),angular.module("pmkr.components.services",["pmkr.debounce","pmkr.memoize","pmkr.filterStabilize","pmkr.rethrowException"]),angular.module("pmkr.pristineOriginal",[]).directive("pmkrPristineOriginal",[function(){var t={restrict:"A",require:"ngModel",link:function(t,e,n,r){var o=null;t.$watch(function(){return r.$viewValue},function(t){null===o&&(o=r.$isEmpty(t)?"":t.toString()),o===t&&r.$setPristine()})}};return t}]),angular.module("pmkr.validateCustom",["pmkr.debounce"]).directive("pmkrValidateCustom",["$q","pmkr.debounce",function(t,e){var n={restrict:"A",require:"ngModel",priority:1,link:function(t,n,r,o){function i(t){o.$setValidity(p.name,t),l.valid=c?l.invalid=null:!(l.invalid=!t)}function u(t){return c?void 0:(l.validating=!0,p.fn(t))}function a(t){return p.gate&&(c=p.gate(t,o))?(l.pending=l.validating=!1,void i(!0)):(l.pending=!0,l.valid=l.invalid=null,void f(t).then(function(e){c||(l.checkedValue=t,i(e),l.pending=l.validating=!1)}))}var p=t.$eval(r.pmkrValidateCustom),l={pending:!1,validating:!1,checkedValue:null,valid:null,invalid:null};p.props&&(t[p.props]=l),i(!0);var c=!1,s=e(u,p.wait),f=e.latest(s);t.$watch(function(){return o.$viewValue},a)}};return n}]),angular.module("pmkr.limitEllipsis",["pmkr.stripTags","pmkr.spaceSentences"]).filter("pmkr.limitEllipsis",["$filter",function(t){function e(t,e,i){if(!t||!t.length)return t;i=i||"...";var u=r(n(t)),a=o(u,e);return a===u?a:a+i}var n=t("pmkr.stripTags"),r=t("pmkr.spaceSentences"),o=t("limitTo");return e}]),angular.module("pmkr.offset",[]).filter("pmkr.offset",[function(){function t(t,e){return t&&t.length?(e=parseInt(e,10),t.slice(e)):t}return t}]),angular.module("pmkr.partition",["pmkr.filterStabilize"]).filter("pmkr.partition",["pmkr.filterStabilize",function(t){var e=t(function(t,e){if(!t||!e)return t;for(var n=[],r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n});return e}]),angular.module("pmkr.shuffle",["pmkr.filterStabilize"]).filter("pmkr.shuffle",["pmkr.filterStabilize",function(t){function e(t){for(var e=t.length;0!==e;){var n=Math.floor(Math.random()*e);e-=1;var r=t[e];t[e]=t[n],t[n]=r}return t}var n=t(function(t){return t?"string"==typeof t?(t=t.split(""),e(t),t.join("")):void e(t):t});return n}]),angular.module("pmkr.slugify",[]).filter("pmkr.slugify",[function(){function t(t){if(!t)return t;var e=t.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");return e}return t}]),angular.module("pmkr.spaceSentences",[]).filter("pmkr.spaceSentences",[function(){function t(t){if(!t)return t;var e=t.replace(/(\w)([.!?]+)(\w)/gi,"$1$2 $3");return e}return t}]),angular.module("pmkr.stripTags",[]).filter("pmkr.stripTags",function(){function t(t,e,n){if(!t)return t;e=e?e.split(","):"";var r=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,o=t.replace(r,function(t,r){var o=~e.indexOf(r.toLowerCase()),i=n?o:!o,u=i?"":t;return u});return o}return t}),angular.module("pmkr.debounce",[]).factory("pmkr.debounce",["$timeout","$q",function(t,e){function n(n,r){function o(){var o=e.defer(),u=this,a=arguments;return t.cancel(i),i=t(function(){o.resolve(n.apply(u,a))},r),o.promise}var i;return o}function r(n,r){function o(){var o=e.defer(),u=this,a=arguments;return i||o.resolve(n.apply(u,a)),t.cancel(i),i=t(function(){i=null},r),o.promise}var i;return o}function o(t){function n(){var n=r=JSON.stringify(arguments),o=e.defer();return t.apply(this,arguments).then(function(t){r===n&&o.resolve(t)},function(t){r===n&&o.reject(t)}),o.promise}var r;return n}var i=function(){return n.apply(this,arguments)};return i.immediate=function(){return r.apply(this,arguments)},i.latest=function(){return o.apply(this,arguments)},i}]),angular.module("pmkr.filterStabilize",["pmkr.memoize"]).factory("pmkr.filterStabilize",["pmkr.memoize",function(t){function e(e){function n(){var t=[].slice.call(arguments);t=angular.copy(t);var n=e.apply(this,t)||t[0];return n}var r=t(n);return r}return e}]),angular.module("pmkr.memoize",[]).factory("pmkr.memoize",[function(){function t(){return e.apply(this,arguments)}function e(t){function e(){var e=[].slice.call(arguments),r=JSON.stringify(e),o=n[r];return o?o:(n[r]=t.apply(this,arguments),n[r])}var n={};return e}return t}]),angular.module("pmkr.rethrowException",[]).provider("pmkr.rethrowException",["$provide",function(t){function e(t){function e(e,n){throw t(e,n),e}return e}this.init=function(){t.decorator("$exceptionHandler",["$delegate",e])},this.$get=function(){}}]),angular.module("pmkr.debounce",[]).factory("pmkr.debounce",function(t){function e(e){return function(){return t.when(e())}}var n=e;return n.latest=e,n}),describe("validateCustom",function(){var t,e,n,r,o;beforeEach(module("pmkr.validateCustom")),beforeEach(module(["$provide",function(t){n=t}])),beforeEach(inject(function(n,i){t=n,e=i,r=angular.element('<form name="form"></form>'),o=angular.element('<input name="foo" ng-model="foo">'),r.append(o),e.opts={name:"unique"}})),it("should accept argument object as view string",function(){e.fooValid=function(){},spyOn(e,"fooValid"),o.attr("pmkr-validate-custom","{name:'unique', fn:fooValid}"),t(r)(e),e.$digest(),expect(e.fooValid).toHaveBeenCalled()}),it("should accept argument object from controller",function(){e.opts.fn=function(){},spyOn(e.opts,"fn"),o.attr("pmkr-validate-custom","opts"),t(r)(e),e.$digest(),expect(e.opts.fn).toHaveBeenCalled()}),it("should initially be valid",function(){o.attr("pmkr-validate-custom","opts"),t(r)(e),expect(e.form.foo.$error.unique).toBe(!1)}),it("should not call opts.fn when gated",function(){e.opts.fn=function(){},e.opts.gate=function(){return!0},spyOn(e.opts,"fn"),o.attr("pmkr-validate-custom","opts"),t(r)(e),e.$digest(),expect(e.opts.fn).not.toHaveBeenCalled()}),it("should be valid when gated",function(){e.opts.gate=function(){return!0},o.attr("pmkr-validate-custom","opts"),t(r)(e),e.form.foo.$setValidity("unique",!1),e.$digest(),expect(e.form.foo.$error.unique).toBe(!1)}),it("should wrap opts.fn in debounce and debounce.latest",function(){var i=!1,u=!1;n.decorator("pmkr.debounce",function(){var t=function(){i=!0};return t.latest=function(){u=!0},t}),o.attr("pmkr-validate-custom","opts"),t(r)(e),expect(i).toBe(!0),expect(u).toBe(!0)}),it("should be valid when opts.fn returns true",function(){e.opts.fn=function(){return!0},o.attr("pmkr-validate-custom","opts"),t(r)(e),e.form.foo.$setValidity("unique",!1),e.$digest(),expect(e.form.foo.$error.unique).toBe(!1)}),it("should be invalid when opts.fn returns false",function(){e.opts.fn=function(){return!1},o.attr("pmkr-validate-custom","opts"),t(r)(e),e.form.foo.$setValidity("unique",!1),e.$digest(),expect(e.form.foo.$error.unique).toBe(!0)}),it("should set props.pending = true while debouncing/validating",function(){n.decorator("pmkr.debounce",function(t){function n(n){return function(){return expect(e.fooProps.pending).toBe(!0),t.when(n())}}var r=n;return r.latest=n,r}),e.opts.props="fooProps",e.opts.fn=function(){expect(e.fooProps.pending).toBe(!0)},o.attr("pmkr-validate-custom","opts"),t(r)(e),expect(e.fooProps.pending).toBe(!1),e.$digest(),expect(e.fooProps.pending).toBe(!1)}),it("should set props.validating = true while validating",function(){n.decorator("pmkr.debounce",function(t){function n(n){return function(){return expect(e.fooProps.validating).toBe(!1),t.when(n())}}var r=n;return r.latest=n,r}),e.opts.props="fooProps",e.opts.fn=function(){expect(e.fooProps.validating).toBe(!0)},o.attr("pmkr-validate-custom","opts"),t(r)(e),expect(e.fooProps.validating).toBe(!1),e.$digest(),expect(e.fooProps.validating).toBe(!1)}),it("should set props.checkedValue to the most recent checked value",function(){e.opts.fn=function(){return!0},e.opts.props="fooProps",o.attr("pmkr-validate-custom","opts"),t(r)(e),expect(e.fooProps.checkedValue).toBe(null),e.form.foo.$setViewValue("abc"),e.$digest(),expect(e.fooProps.checkedValue).toBe("abc")})});
//# sourceMappingURL=components.min.js.map